<!--
 ****************************************************************************************
 *
 * anyPaginator is copyright (C) 2021-2022 Arne D. Morken and Balanse Software.
 *
 * License: MIT.
 *
 * See also the anyList project: https://github.com/arnemorken/anylist
 *
 ****************************************************************************************
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="https://balanse.info/cdn/thirdparty/jquery/jquery-3.6.0.min.js"></script>
  <script src="../anyPaginator.js"></script>
  <link  href="../anyPaginator.css" rel="stylesheet"/>
  <title>anyPaginator example - remote data</title>
</head>

<body>

<div id="mydiv">
  <h3>anyPaginator table pager example - remote data</h3>
  <table id="mytable" style="border-collapse: collapse;">
    <tbody style="border: 1px solid #333;">
    </tbody>
    <tfoot>
      <tr><td id="myfoot"></td></tr>
    </tfoot>
  </table>
</div>

<script>
let cdn = "https://balanse.info/cdn/anypaginator/examples/";

function refreshTable(pager,num)
{
  if (!pager)
    return;
  let from = pager.options.rowsPerPage *(pager.currentPage - 1);
  let to   = from + pager.options.rowsPerPage - 1;
  let db_url = cdn + "remote_select.php?from="+from+"&to="+to;
  $.getJSON(db_url)
  .done( function(data,textStatus,jqXHR) {
    if (textStatus == "success") {
      let tbody = $("#mytable > tbody");
      if (tbody.length)
        tbody.empty();
      // Display all items received
      for (const i in data)
        tbody.append($("<tr><td>"+data[i]+"</td></tr>"));
      populatePager(pager,num,pager.currentPage);
    }
    else
    if (textStatus == "error")
      console.log("Error: "+jqXHR.status+": "+jqXHR.statusText);
  })
  .fail(function(jqXHR,textStatus,error) {
      console.error("Server error (select):"+jqXHR.responseText);
  });
} // refreshTable

function populatePager(pager,num,page)
{
  if (!pager)
    return;
  pager.reset();
  let page_no = 1;
  for (let i=1; i<=num; i++) {
    // Add a page number each rowsPerPage rows
    if (!((i-1) % pager.options.rowsPerPage)) {
      pager.anyPaginator("add");
      ++page_no;
    }
  }
  pager.showPage(page);
} // populatePager

// Create remote table
let num = 70; // Number of rows
let db_url = cdn + "remote_create.php?num="+num;
$.getJSON(db_url)
.done( function(data,textStatus,jqXHR) {

  // Initialize paginator in tfoot
  let pager =  $("#myfoot").anyPaginator({ mode:        0,
                                           onClick:     function() { refreshTable(pager,num); },
                                           rowsPerPage: 5,
                                           prevText:    "<",
                                           nextText:    ">",
                                        });
  // Display table contents
  refreshTable(pager,num);

  // Add page numbers
  populatePager(pager,num);
})
.fail(function(jqXHR,textStatus,error) {
  console.error("Server error (create):"+jqXHR.responseText);
});
</script>

</body>
</html>